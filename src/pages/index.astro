---
import BaseLayout from '@/layouts/BaseLayout.astro'
import { getBookGroups, getBookPath } from '@/utils/books'
import {
  SITE_TITLE,
  SITE_DESCRIPTION,
  BOOKS,
  BOOK_ORDER,
} from '@/utils/constants'

const bookGroups = await getBookGroups()

const totalChapters = bookGroups.reduce((sum, g) => sum + g.chapters.length, 0)
const totalQuizzes = bookGroups.reduce(
  (sum, g) => sum + g.chapters.length * 3,
  0
)

const bookColorClasses: Record<string, string> = {
  purple: 'border-purple-500/30 hover:border-purple-500',
  orange: 'border-orange-500/30 hover:border-orange-500',
  cyan: 'border-cyan-500/30 hover:border-cyan-500',
}

const bookBadgeClasses: Record<string, string> = {
  purple: 'bg-purple-500/10 text-purple-500',
  orange: 'bg-orange-500/10 text-orange-500',
  cyan: 'bg-cyan-500/10 text-cyan-500',
}
---

<BaseLayout title="" description={SITE_DESCRIPTION}>
  <main class="mx-auto max-w-6xl px-4 py-12 sm:px-6 lg:px-8">
    <!-- Hero -->
    <section class="mb-16 text-center">
      <h1 class="mb-4 text-3xl font-bold tracking-tight sm:text-4xl lg:text-5xl">
        {SITE_TITLE}
      </h1>
      <p class="mx-auto max-w-2xl text-lg text-muted">
        {SITE_DESCRIPTION}
      </p>
      <div class="mt-6 flex justify-center gap-4 text-sm text-muted">
        <span>全3冊</span>
        <span>{totalChapters}章</span>
        <span>{totalQuizzes}クイズ</span>
      </div>
    </section>

    <!-- Book Cards -->
    <section>
      <h2 class="mb-8 text-xl font-semibold">書籍一覧</h2>
      <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {
          BOOK_ORDER.map((bookId) => {
            const book = BOOKS[bookId]
            const group = bookGroups.find((g) => g.bookId === bookId)
            const chapterCount = group?.chapters.length || book.totalChapters
            const colorClass = bookColorClasses[book.color] || ''
            const badgeClass = bookBadgeClasses[book.color] || ''

            return (
              <a
                href={getBookPath(bookId)}
                class:list={[
                  'group flex flex-col rounded-xl border-2 p-6 transition-all hover:bg-card',
                  colorClass,
                ]}
              >
                <div class="mb-3 flex items-center justify-between">
                  <span class:list={['rounded-full px-3 py-1 text-xs font-medium', badgeClass]}>
                    {book.shortTitle}
                  </span>
                </div>
                <h3 class="mb-2 text-base font-semibold text-foreground group-hover:text-accent">
                  {book.title}
                </h3>
                <p class="mb-4 text-sm leading-relaxed text-muted line-clamp-3">
                  {book.description}
                </p>
                <div class="mt-auto flex items-center justify-between text-xs text-muted">
                  <span>{chapterCount}章</span>
                  <span class="flex items-center gap-1 text-accent opacity-0 transition-opacity group-hover:opacity-100">
                    読む
                    <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                  </span>
                </div>
              </a>
            )
          })
        }
      </div>
    </section>
  </main>
</BaseLayout>
